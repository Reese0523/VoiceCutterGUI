# appveyor.yml
image: Visual Studio 2022   # 或者 VS2019，根据你的需求

# 环境变量必须是 mapping，不是 list
environment:
  PYTHON: C:\Python311

install:
  # 更新 pip
  - "%PYTHON%\\python.exe -m pip install --upgrade pip"
  # 把 Scripts 放到 PATH，才能调用 pyinstaller.exe、imageio_download_bin.exe 等
  - set PATH=%PYTHON%\\Scripts;%PATH%
  # 安装所有打包需要的包
  - "%PYTHON%\\python.exe -m pip install pyinstaller pyinstaller-hooks-contrib moviepy whisper tqdm numpy imageio_ffmpeg"

build_script:
  # 调用你的打包脚本
  - call build_pyinstaller.bat

test_script:
  # 用 --help 验证 exe 能正常启动，否则报错退出
  - cmd: dist\voice_cutter_gui.exe --help > voice_cutter_gui.log 2>&1
    fail_on_exit: true

artifacts:
  # 把 help 输出作为日志下载
  - path: voice_cutter_gui.log
    name: help_log
